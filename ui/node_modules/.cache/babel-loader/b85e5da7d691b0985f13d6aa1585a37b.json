{"ast":null,"code":"import _slicedToArray from\"/Users/cathyjung/Desktop/cathy/daml-PrivateNFT/ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import{damlAppKey,getParty,getToken}from\"../config\";var UserStateContext=React.createContext({isAuthenticated:false});var UserDispatchContext=React.createContext({});function userReducer(state,action){switch(action.type){case\"LOGIN_SUCCESS\":return{isAuthenticated:true,name:action.name,token:action.token,party:action.party};case\"LOGIN_FAILURE\":return{isAuthenticated:false};case\"SIGN_OUT_SUCCESS\":return{isAuthenticated:false};}}var UserProvider=function UserProvider(_ref){var children=_ref.children;var name=localStorage.getItem(damlAppKey)||\"\";var party=getParty(name);var token=getToken(party);var initState=!!party&&!!token?{isAuthenticated:true,name:name,token:token,party:party}:{isAuthenticated:false};var _React$useReducer=React.useReducer(userReducer,initState),_React$useReducer2=_slicedToArray(_React$useReducer,2),state=_React$useReducer2[0],dispatch=_React$useReducer2[1];return/*#__PURE__*/React.createElement(UserStateContext.Provider,{value:state},/*#__PURE__*/React.createElement(UserDispatchContext.Provider,{value:dispatch},children));};function useUserState(){var context=React.useContext(UserStateContext);if(context===undefined){throw new Error(\"useUserState must be used within a UserProvider\");}return context;}function useUserDispatch(){var context=React.useContext(UserDispatchContext);if(context===undefined){throw new Error(\"useUserDispatch must be used within a UserProvider\");}return context;}// ###########################################################\nfunction loginUser(dispatch,name,userToken,history,setIsLoading,setError){setError(false);setIsLoading(true);if(!!name){var party=getParty(name);var token=getToken(party);localStorage.setItem(damlAppKey,name);dispatch({type:\"LOGIN_SUCCESS\",name:name,token:token,party:party});setError(false);setIsLoading(false);history.push(\"/app\");}else{dispatch({type:\"LOGIN_FAILURE\"});setError(true);setIsLoading(false);}}function signOut(dispatch,history){localStorage.removeItem(damlAppKey);dispatch({type:\"SIGN_OUT_SUCCESS\"});history.push(\"/login\");}export{UserProvider,useUserState,useUserDispatch,loginUser,signOut};","map":{"version":3,"sources":["/Users/cathyjung/Desktop/cathy/daml-PrivateNFT/ui/src/context/UserContext.tsx"],"names":["React","damlAppKey","getParty","getToken","UserStateContext","createContext","isAuthenticated","UserDispatchContext","userReducer","state","action","type","name","token","party","UserProvider","children","localStorage","getItem","initState","useReducer","dispatch","useUserState","context","useContext","undefined","Error","useUserDispatch","loginUser","userToken","history","setIsLoading","setError","setItem","push","signOut","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { History } from 'history';\nimport { damlAppKey, getParty, getToken } from \"../config\";\n\ntype AuthenticatedUser = {\n  isAuthenticated : true\n  name : string\n  token : string\n  party : string\n}\n\ntype UnAthenticated = {\n  isAuthenticated : false\n}\n\ntype UserState = UnAthenticated | AuthenticatedUser\n\ntype LoginSuccess = {\n  type : \"LOGIN_SUCCESS\"\n  name : string\n  token : string\n  party : string\n}\n\ntype LoginFailure = {\n  type : \"LOGIN_FAILURE\"\n}\n\ntype SignoutSuccess = {\n  type : \"SIGN_OUT_SUCCESS\"\n}\n\ntype LoginAction = LoginSuccess | LoginFailure | SignoutSuccess\n\nconst UserStateContext = React.createContext<UserState>({ isAuthenticated: false });\nconst UserDispatchContext = React.createContext<React.Dispatch<LoginAction>>({} as React.Dispatch<LoginAction>);\n\nfunction userReducer(state : UserState, action : LoginAction) : UserState {\n  switch (action.type) {\n    case \"LOGIN_SUCCESS\":\n      return { isAuthenticated: true, name: action.name, token: action.token, party: action.party };\n    case \"LOGIN_FAILURE\":\n      return { isAuthenticated: false };\n    case \"SIGN_OUT_SUCCESS\":\n      return { isAuthenticated: false };\n  }\n}\n\nconst UserProvider : React.FC = ({ children }) => {\n  const name = localStorage.getItem(damlAppKey) || \"\";\n  const party = getParty(name);\n  const token = getToken(party);\n\n  let initState : UserState = (!!party && !!token) ? { isAuthenticated : true, name, token, party } : { isAuthenticated : false };\n  const [state, dispatch] = React.useReducer<React.Reducer<UserState,LoginAction>>(userReducer, initState);\n\n  return (\n    <UserStateContext.Provider value={state}>\n      <UserDispatchContext.Provider value={dispatch}>\n        {children}\n      </UserDispatchContext.Provider>\n    </UserStateContext.Provider>\n  );\n}\n\nfunction useUserState() {\n  const context = React.useContext<UserState>(UserStateContext);\n  if (context === undefined) {\n    throw new Error(\"useUserState must be used within a UserProvider\");\n  }\n  return context;\n}\n\nfunction useUserDispatch() {\n  const context = React.useContext<React.Dispatch<LoginAction>>(UserDispatchContext);\n  if (context === undefined) {\n    throw new Error(\"useUserDispatch must be used within a UserProvider\");\n  }\n  return context;\n}\n\n\n// ###########################################################\n\nfunction loginUser(\n    dispatch : React.Dispatch<LoginAction>,\n    name : string,\n    userToken : string,\n    history : History,\n    setIsLoading : React.Dispatch<React.SetStateAction<boolean>>,\n    setError : React.Dispatch<React.SetStateAction<boolean>>) {\n  setError(false);\n  setIsLoading(true);\n\n  if (!!name) {\n    var party = getParty(name);\n    var token = getToken(party);\n    localStorage.setItem(damlAppKey, name);\n\n    dispatch({ type: \"LOGIN_SUCCESS\", name, token, party });\n    setError(false);\n    setIsLoading(false);\n    history.push(\"/app\");\n  } else {\n    dispatch({ type: \"LOGIN_FAILURE\" });\n    setError(true);\n    setIsLoading(false);\n  }\n}\n\nfunction signOut(dispatch : React.Dispatch<LoginAction>, history : History) {\n  localStorage.removeItem(damlAppKey);\n\n  dispatch({ type: \"SIGN_OUT_SUCCESS\" });\n  history.push(\"/login\");\n}\n\nexport { UserProvider, useUserState, useUserDispatch, loginUser, signOut };\n"]},"metadata":{},"sourceType":"module"}